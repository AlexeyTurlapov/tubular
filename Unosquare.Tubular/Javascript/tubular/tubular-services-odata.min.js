(function(){"use strict";angular.module("tubular.services").service("tubularOData",["tubularHttp",function(n){var t=this;t.requireAuthentication=!0;t.setRequireAuthentication=function(n){t.requireAuthentication=n};t.operatorsMapping={None:"",Equals:"{0} eq {1}",Contains:"substringof({1}, {0}) eq true",StartsWith:"startswith({0}, {1}) eq true",EndsWith:"endswith({0}, {1}) eq true",Gte:"{0} ge {1}",Gt:"{0} gt {1}",Lte:"{0} le {1}",Lt:"{0} lt {1}"};t.retrieveDataAsync=function(i){var r=i.data,u=i.serverUrl,e,f,o,s,h;return u+=u.indexOf("?")>0?"&":"?",u+="$format=json&$inlinecount=allpages",u+="&$select="+r.Columns.map(function(n){return n.Name}).join(","),u+="&$skip="+r.Skip,u+="&$top="+r.Take,e=r.Columns.filter(function(n){return n.SortOrder>0}).sort(function(n,t){return n.SortOrder-t.SortOrder}).map(function(n){return n.Name+" "+(n.SortDirection=="Descending"?"desc":"")}),e.length>0&&(u+="&$orderby="+e.join(",")),f=r.Columns.filter(function(n){return n.Filter!=null&&n.Filter.Text!=null}).map(function(n){return t.operatorsMapping[n.Filter.Operator].replace("{0}",n.Name).replace("{1}",n.DataType=="string"?"'"+n.Filter.Text+"'":n.Filter.Text)}).filter(function(n){return n.length>1}),r.Search!=null&&r.Search.Operator=="Auto"&&(o=r.Columns.filter(function(n){return n.Searchable}).map(function(n){return"startswith({0}, '{1}') eq true".replace("{0}",n.Name).replace("{1}",r.Search.Text)}),o.length>0&&f.push("("+o.join(" or ")+")")),f.length>0&&(u+="&$filter="+f.join(" and ")),i.data=null,i.serverUrl=u,n.setRequireAuthentication(i.requireAuthentication||t.requireAuthentication),s=n.retrieveDataAsync(i),h=s.promise.then(function(n){var t={Payload:n.value,CurrentPage:1,TotalPages:1,TotalRecordCount:1,FilteredRecordCount:1};return t.TotalRecordCount=n["odata.count"],t.FilteredRecordCount=t.TotalRecordCount,t.TotalPages=parseInt(t.TotalRecordCount/r.Take),t.CurrentPage=parseInt(1+r.Skip/t.FilteredRecordCount*t.TotalPages),t}),{promise:h,cancel:s.cancel}};t.saveDataAsync=function(i,r){n.setRequireAuthentication(r.requireAuthentication||t.requireAuthentication);n.saveDataAsync(i,r)};t.get=function(t){n.get(t)};t.delete=function(t){n.delete(t)};t.post=function(t,i){n.post(t,i)};t.put=function(t,i){n.put(t,i)}}])})();
//# sourceMappingURL=tubular-services-odata.min.js.map
