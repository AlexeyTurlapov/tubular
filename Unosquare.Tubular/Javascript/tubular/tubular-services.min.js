(function(){"use strict";angular.module("tubular.services",["ui.bootstrap"]).service("tubularPopupService",["$modal",function(n){var t=this;t.openDialog=function(t,i){var r=n.open({templateUrl:t,backdropClass:"fullHeight",controller:["$scope",function(n){n.Model=i;n.savePopup=function(){n.Model.save(!0);n.$on("tbGrid_OnSuccessfulUpdate",function(){r.close()})};n.closePopup=function(){angular.isDefined(n.Model.revertChanges)&&n.Model.revertChanges();r.close()}}]});return r}}]).service("tubularGridExportService",function(){var n=this;n.getColumns=function(n){return n.columns.map(function(n){return n.Name.replace(/([a-z])([A-Z])/g,"$1 $2")})};n.exportAllGridToCsv=function(t,i){var r=n.getColumns(i);i.getFullDataSource(function(i){n.exportToCsv(t,r,i)})};n.exportGridToCsv=function(t,i){var r=n.getColumns(i);i.currentRequest={};n.exportToCsv(t,r,i.dataSource.Payload);i.currentRequest=null};n.exportToCsv=function(n,t,i){var f=function(n){for(var u,i,r="",t=0;t<n.length;t++)u=n[t]===null?"":n[t].toString(),n[t]instanceof Date&&(u=n[t].toLocaleString()),i=u.replace(/"/g,'""'),i.search(/("|,|\n)/g)>=0&&(i='"'+i+'"'),t>0&&(r+=","),r+=i;return r+"\n"},u="",r,e;for(t.length>0&&(u+=f(t)),r=0;r<i.length;r++)u+=f(i[r]);e=new Blob([u],{type:"text/csv;charset=utf-8;"});saveAs(e,n)}}).service("tubularGridFilterService",["tubulargGridFilterModel","$compile","$modal",function(n,t,i){var r=this;r.applyFilterFuncs=function(n,r,u,f){n.columnSelector=u.columnSelector||!1;n.$component=n.$parent.$component;n.filterTitle="Filter";n.clearFilter=function(){n.filter.Operator="None";n.filter.Text="";n.filter.Argument=[];n.$component.retrieveData();n.close()};n.applyFilter=function(){n.$component.retrieveData();n.close()};n.close=function(){$(r).find('[data-toggle="popover"]').popover("hide")};n.openColumnsSelector=function(){n.close();var t=n.$component.columns,r=i.open({template:'<div class="modal-header"><h3 class="modal-title">Columns Selector<\/h3><\/div><div class="modal-body"><div class="row" ng-repeat="col in Model"><div class="col-xs-2"><input type="checkbox" ng-model="col.Visible" /><\/div><div class="col-xs-10">{{col.Label}}<\/li><\/div><\/div><\/div><div class="modal-footer"><button class="btn btn-warning" ng-click="closePopup()">Close<\/button><\/div>',backdropClass:"fullHeight",controller:["$scope",function(n){n.Model=t;n.closePopup=function(){r.close()}}]})};$(r).find('[data-toggle="popover"]').popover({html:!0,content:function(){var i=$(this).next().find("select").find("option").remove().end();return angular.forEach(n.filterOperators,function(n,t){$(i).append('<option value="'+t+'">'+n+"<\/option>")}),t($(this).next().html())(n)}});$(r).find('[data-toggle="popover"]').on("shown.bs.popover",f)};r.createFilterModel=function(t,i){t.filter=new n(i);t.filter.Name=t.$parent.column.Name;var r=t.$component.columns.filter(function(n){return n.Name===t.filter.Name});r.length!==0&&(r[0].Filter=t.filter,t.dataType=r[0].DataType,t.filterOperators=r[0].FilterOperators[t.dataType],(t.dataType=="datetime"||t.dataType=="date")&&(t.filter.Argument=[new Date]),t.dataType=="numeric"&&(t.filter.Argument=[1]),t.filterTitle=i.title||"Filter")}}]).service("tubularEditorService",[function(){var n=this;n.defaultScope={value:"=?",state:"=?",isEditing:"=?",editorType:"@",showLabel:"=?",label:"@?",required:"=?",format:"=?",min:"=?",max:"=?",name:"@",defaultValue:"=?",IsKey:"@",placeholder:"@?",readOnly:"=?",help:"@?"};n.setupScope=function(n,t){n.isEditing=angular.isUndefined(n.isEditing)?!0:n.isEditing;n.showLabel=n.showLabel||!1;n.label=n.label||(n.name||"").replace(/([a-z])([A-Z])/g,"$1 $2");n.required=n.required||!1;n.readOnly=n.readOnly||!1;n.format=n.format||t;n.$valid=!0;n.$editorType="input";angular.isUndefined(n.defaultValue)==!1&&angular.isUndefined(n.value)&&(n.value=n.defaultValue);n.$watch("value",function(t,i){if(!angular.isUndefined(i)||!angular.isUndefined(t)){if(angular.isUndefined(n.state)&&(n.state={$valid:function(){return this.$errors==0},$errors:[]}),n.$valid=!0,n.state.$errors=[],angular.isDefined(n.$parent.Model)&&(angular.isDefined(n.$parent.Model[n.name])?n.$parent.Model[n.name]=t:angular.isDefined(n.$parent.Model.$addField)&&n.$parent.Model.$addField(n.name,t)),angular.isUndefined(n.value)&&n.required){n.$valid=!1;n.state.$errors=["Field is required"];return}angular.isUndefined(n.validate)||n.validate()}});for(var i=n.$parent;;){if(i==null)break;if(angular.isUndefined(i.tubularDirective)==!1&&i.tubularDirective=="tubular-form"){i.addField(n);break}i=i.$parent}}}])})();
//# sourceMappingURL=tubular-services.min.js.map
