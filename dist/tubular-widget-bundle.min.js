(function(){"use strict";angular.module("tubular-widget.directives",["tubular.services"]).directive("tbWidgetContainer",[function(){return{template:'<div class="container"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{name:"@?containerName"},controller:["$scope","localStorageService",function(n,t){n.name=n.name||"tbcontainer";n.widgets=[];n.settings=t.get(n.name+"_data");n.redraw=function(){angular.forEach(n.widgets,function(n){var t=n.content.parent();n.oneColumn?(t.find("div.widget-panel").length===1&&t.next().hasClass("row")&&(t.append(t.next().find("div.widget-panel")),t.next().find("div.widget-panel").length===0&&t.next().remove()),t.find("div.widget-panel").length>2&&$('<div class="row"><\/div>').insertAfter(t).append(t.find("div.widget-panel").last())):t.find("div.widget-panel").length>1&&$('<div class="row"><\/div>').insertBefore(t).append(n.content)});n.saveSettings()};n.saveSettings=function(){var i={};angular.forEach(n.widgets,function(n){i[n.name]={position:n.position,oneColumn:n.oneColumn,collapsed:n.collapsed}});t.set(n.name+"_data",i)}}],compile:function(){return{post:function(n){n.settings&&angular.forEach(n.widgets,function(t){var i=n.settings[t.name];i&&(t.oneColumn=i.oneColumn,t.collapsed=i.collapsed,t.position!==i.position&&t.moveAt(i.position))})}}}}}]).directive("tbWidget",[function(){return{template:'<div class="widget-panel"><div class="tubular-overlay maximized" ng-show="maximized"><\/div><div ng-class="{ \'col-md-6\': oneColumn, \'col-md-12\': !oneColumn, \'maximized\': maximized}"><div class="panel panel-default"><div class="panel-heading"><span>{{title}}<\/span> <div class="pull-right"><button ng-hide="maximized" ng-disabled="top" ng-click="move(-2)" class="btn btn-default btn-xs"  title="{{\'UI_MOVEUP\'| translate}}"><span><i class="glyphicon glyphicon-arrow-up"><\/i><\/span><\/button><button ng-hide="maximized" ng-disabled="bottom" ng-click="move(2)" class="btn btn-default btn-xs"  title="{{\'UI_MOVEDOWN\'| translate}}"><span><i class="glyphicon glyphicon-arrow-down"><\/i><\/span><\/button><button ng-hide="maximized" ng-disabled="!oneColumn || !even" ng-click="move(1)" class="btn btn-default btn-xs"  title="{{\'UI_MOVERIGHT\'| translate}}"><span><i class="glyphicon glyphicon-arrow-right"><\/i><\/span><\/button><button ng-hide="maximized" ng-disabled="!oneColumn || even" ng-click="move(-1)" class="btn btn-default btn-xs"  title="{{\'UI_MOVELEFT\'| translate}}"><span><i class="glyphicon glyphicon-arrow-left"><\/i><\/span><\/button><button ng-hide="!oneColumn || maximized" ng-click="oneColumn = false" class="btn btn-default btn-xs" title="{{\'UI_TWOCOLS\'| translate}}"><span><i class="glyphicon glyphicon-resize-horizontal"><\/i><\/span><\/button><button ng-hide="oneColumn || maximized" ng-click="oneColumn = true" class="btn btn-default btn-xs"  title="{{\'UI_ONECOL\'| translate}}"><span><i class="glyphicon glyphicon-resize-horizontal"><\/i><\/span><\/button><button ng-hide="collapsed || maximized" ng-click="collapsed = true" class="btn btn-default btn-xs"  title="{{\'UI_COLLAPSE\'| translate}}"><span><i class="glyphicon glyphicon-menu-up"><\/i><\/span><\/button><button ng-hide="!collapsed || maximized" ng-click="collapsed = false" class="btn btn-default btn-xs"  title="{{\'UI_EXPAND\'| translate}}"><span><i class="glyphicon glyphicon-menu-down"><\/i><\/span><\/button><button ng-hide="maximized" ng-click="maximized = true;" class="btn btn-default btn-xs"  title="{{\'UI_MAXIMIZE\'| translate}}"><span><i class="glyphicon glyphicon-resize-full"><\/i><\/span><\/button><button ng-hide="!maximized" ng-click="maximized = false" class="btn btn-default btn-xs"  title="{{\'UI_RESTORE\'| translate}}"><span><i class="glyphicon glyphicon-resize-small"><\/i><\/span><\/button><\/div><\/div><div class="panel-body" ng-hide="collapsed && !maximized"><ng-transclude><\/ng-transclude><\/div><div class="panel-body" ng-show="collapsed && !maximized">{{summary}}<\/div><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{title:"@",name:"@?widgetName",summary:"=?widgetSummary"},controller:function(n,t){function i(n,t){var i=n.parentNode,r=n.nextSibling===t?n:n.nextSibling;t.parentNode.insertBefore(n,t);i.insertBefore(t,r)}n.name=n.name||"tbwidget";n.oneColumn=!0;n.collapsed=!1;n.maximized=!1;n.position=0;n.content=t;n.container=n.$parent.$parent;n.container.widgets.push(n);n.calculatePositions=function(t){n.top=t===0||t===1;n.bottom=t===n.container.widgets.length-1||t===n.container.widgets.length-2;n.even=t%2==0;n.position=t};n.$watch("$parent.widgets",function(){var t=n.container.widgets.indexOf(n);n.calculatePositions(t)});n.$watch("oneColumn",function(){n.container.redraw()});n.$watch("collapsed",function(){n.container.saveSettings()});n.move=function(t){n.moveAt(n.position+t)};n.moveAt=function(r){var u=n.container.widgets[r];u&&(n.container.widgets[r]=n,n.container.widgets[n.position]=u,u.calculatePositions(n.position),n.calculatePositions(r),i(u.content[0],t[0]),n.container.redraw())}}}}])})();